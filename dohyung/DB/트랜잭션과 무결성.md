# 트랜잭션과 무결성

# 트랜잭션

## 원자성

원자성은 트랜잭션과 관련된 일이 모두 수행되었거나 되지 않았거나를 보장하는 특징이다.

## 일관성

일관성은 허용된 방식으로만 데이터를 변경해야 하는 것을 의미한다.

## 격리성

격리성은 트랜잭션 수행 시 끼어들지 못하는 것을 말한다.

### 격리 수준

격리 수준은 SERIALIZABLE, REPEATABLE_READ, READ_COMMITTED, READ_UNCOMMITTED가 있다.  
오른쪽으로 갈수록 동시성이 강해지지만 격리성은 약해진다.

- **SERIALIZABLE**: 트랜잭션을 순차적으로 진행시키고 여러 트랜잭션이 동시에 같은 행에 접근할 수 없다. 매우 엄격한 격리 수준이다.
- **REPEATABLE_READ**: 하나의 트랜잭션이 수정한 행을 다른 트랜잭션이 수정할 수 없도록 막아주지만 새로운 행을 추가하는 것은 막지 않는다.
- **READ_COMMITTED**: 다른 트랜잭션이 커밋하지 않은 정보는 읽을 수 없다. 커밋 완료된 데이터에 대해서만 조회를 허용한다.
- **READ_UNCOMMITTED**: 하나의 트랜잭션이 커밋되기 전에 다른 트랜잭션에 노출되는 문제가 있지만 가장 빠르다. 가장 낮은 격리 수준이다.

### 격리 수준에 따라 발생하는 현상

- **팬텀 리드**: 한 트랜잭션 내에서 동일한 쿼리를 보냈을 때 해당 조회 결과가 다른 경우를 말한다.
- **반복 가능하지 않은 조회**: 한 트랜잭션 내의 같은 행에 두 번 이상 조회가 발생했는데, 그 값이 다른 경우를 말한다.
- **더티 리드**: 한 트랜잭션이 실행 중일 때 다른 트랜잭션에 의해 수정되었지만 아직 커밋 되지 않은 행의 데이터를 읽을 수 있을 때 발생한다.

## 지속성

성공적으로 수행된 트랜잭션은 영원히 반영되어야 하는 것을 의미한다.

# 무결성

데이터의 정확성, 일관성, 유효성을 유지하는 것을 말한며, 무결성이 유지되어야 DB와 현실의 값 일치를 통해 신뢰성도 유지할 수 있다.

- **개체 무결성** : 기본키로 선택된 필드는 빈 값을 허용하지 않는다.
- **참조 무결성** : 서로 참조 관계에 있는 두 데이터는 항상 일관된 값을 유지해야 한다.
- **고유 무결성** : 특정 속성에 대해 고유한 값을 가지도록 조건이 주어진 경우, 모두 고유한 값을 가진다.
- **NULL 무결성** : 특정 속성 값에 NULL이 올 수 없는 조건이 주어진 경우, 값은 NULL이 될 수 없다.