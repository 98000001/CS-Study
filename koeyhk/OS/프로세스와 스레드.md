# 3.3 프로세스와 스레드

- 프로세스: 컴퓨터에서 실행되고 있는 프로그램, CPU 스케줄링의 대상이 되는 task라는 용어와 거의 같은 의미
- 스레드: 프로세스 내 작업의 흐름 지칭

<br>

## 3.3.1 프로세스와 컴파일 과정

- 프로세스는 프로그램이 메모리에 올라가 인스턴스화된 것을 말함
- 컴파일 과정 (C언어 기반)
    - 전처리: 소스 코드의 주석을 제거하고 헤더 파일 병합해 매크로 치환
    - 컴파일러: 오류 처리, 코드 최적화 작업을 하며 어셈블리어로 변환
    - 어셈블리어: 목적 코드로 변환됨
    - 링커: 프로그램 내의 라이브러리 함수 또는 다른 파일들과 목적 코드를 결합해 실행 파일 만듦
        - 정적 라이브러리: 프로그램 빌드 시 라이브러리가 제공하는 모든 코드를 실행 파일에 넣음 (외부 의존도가 낮은 장점이 있지만 메모리 효율성이 떨어짐)
        - 동적 라이브러리: 프로그램 실행 시 필요할 때만 DLL이라는 함수 정보를 통해 참조하여 라이브러리 사용 (메모리 효율성에서의 장점을 지니지만 외부 의존도가 높음)

<br>

## 3.3.2 프로세스의 상태

<img src="https://github.com/98000001/CS-Study/assets/80199502/8a953adb-664c-4f99-8d65-2b261e334d37" width=700>

- 생성 상태 (create): 프로세스가 생성된 상태로 fork() 또는 exec() 함수를 통해 생성. 이때 PCB 할당됨
    - fork(): 부모 프로세스의 주소 공간만 그대로 복사하며 새로운 자식 프로세스 생성
    - exec(): 새롭게 프로세스 생성하는 함수
- 대기 상태 (ready): 메모리 공간이 충분하면 메모리를 할당받고 아니면 대기 (CPU 스케줄러로부터 CPU 소유권이 넘어오기를 기다리는 상태)
- 대기 중단 상태 (ready suspended): 메모리 부족으로 일시 중단된 상태
- 실행 상태 (running): CPU 소유권과 메모리를 할당받고 인스트럭션을 수행 중인 상태 (CPU burst가 일어났다라고도 표현
- 중단 상태 (blocked): 어떤 이벤트가 발생한 이후 기다리면 프로세스가 차단된 상태 (I/O 디바이스에 의한 인터럽트로 많이 발생)
- 일시 중단 상태 (blocked suspended): 대기 중단과 유사. 중단된 상태에서 프로세스가 실행되려고 했지만 메모리 부족으로 일시 중단된 상태
- 종료 상태 (terminated): 메모리와 CPU 소유권을 모두 놓고 가는 상태. 부모 프로세스가 자식 프로세스를 강제로 종료시키는 비자발적 종료(abort)도 존재

<br>

## 3.3.3 프로세스의 메모리 구조

운영체제는 프로세스에 적절한 메모리를 할당

### 스택과 힙

<img src="https://github.com/98000001/CS-Study/assets/80199502/b2cce67e-d2b4-452b-aedf-de9ba74011ee" width=150>

- 동적 할당 (런타임 단계에서 메모리를 할당받음)
- 스택: 지역변수, 매개변수, 실행되는 함수에 의해 늘어나거나 줄어드는 메모리 영역 (함수 호출될 때 정보가 저장)
- 힙: 동적으로 할당되는 변수들을 담음 (동적으로 관리되는 자료 구조의 경우 힙 영역 사용)

### 데이터 영역과 코드 영역

- 정적 할당되는 영역 (컴파일 단계에서 메모리를 할당하는 것)
- 데이터 영역은 BSS segment, Data segment, code/text segment로 나누어서 저장됨
- BSS segment: 전역 변수 또는 static, const로 선언되어 있고 0으로 초기화 또는 초기화 되지 않은 변수들이 할당
- Data segment: 전역 변수 또는 static, const로 선언되어 있고 0이 아닌 값으로 초기화된 변수가 메모리 영역에 할당
- code segment: 프로그램의 코드가 들어감


<br><br><br><br><br>

참고 자료: <br>
https://velog.io/@0mi/%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4%EC%9D%98-%EA%B0%9C%EB%85%90-%EA%B5%AC%EC%A1%B0-%EC%83%81%ED%83%9C-%EB%B3%80%ED%99%94 <br>
https://velog.io/@cchloe2311/%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C-%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4-%EB%A9%94%EB%AA%A8%EB%A6%AC-%EA%B5%AC%EC%A1%B0 <br>
